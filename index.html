<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whoop ç‰¹å…¸ä¼šæ¨¡æ‹Ÿå™¨ (æˆå‘˜æŒ‡å®šç‰ˆ)</title>
    <style>
        :root { --whoop-red: #ff4757; --whoop-dark: #1e1e1e; }
        body { font-family: -apple-system, system-ui, sans-serif; background: #121212; color: #eee; margin: 0; display: flex; justify-content: center; }
        .app { width: 100%; max-width: 480px; background: var(--whoop-dark); min-height: 100vh; box-shadow: 0 0 20px rgba(0,0,0,0.5); position: relative; }
        .header { padding: 40px 20px; text-align: center; background: linear-gradient(180deg, #2c2c2c 0%, var(--whoop-dark) 100%); }
        .header h1 { margin: 0; font-size: 24px; letter-spacing: 1px; color: white; }
        .section { padding: 20px; border-bottom: 1px solid #333; }
        label { display: block; font-size: 13px; color: #888; margin-bottom: 12px; text-transform: uppercase; }
        
        /* æˆå‘˜é€‰æ‹© */
        .member-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .m-btn { background: #2a2a2a; border: 1px solid #444; color: #ccc; padding: 12px 5px; border-radius: 8px; font-size: 12px; cursor: pointer; transition: 0.2s; }
        .m-btn.active { background: var(--whoop-red); border-color: var(--whoop-red); color: white; font-weight: bold; }
        
        /* è¾“å…¥æ¡† */
        input { width: 100%; background: #2a2a2a; border: 1px solid #444; padding: 15px; border-radius: 10px; color: white; font-size: 18px; box-sizing: border-box; }
        
        .pay-trigger { width: 100%; background: white; color: black; border: none; padding: 18px; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; margin-top: 20px; }
        
        /* è‹¹æœæ”¯ä»˜æ¨¡æ‹Ÿå±‚ */
        #apple-pay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 1000; align-items: flex-end; }
        .pay-sheet { background: white; color: black; width: 100%; border-top-left-radius: 20px; border-top-right-radius: 20px; padding: 30px 20px; box-sizing: border-box; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .pay-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; }
        .face-id { margin: 30px auto; width: 60px; height: 60px; border: 2px solid #007aff; border-radius: 15px; display: flex; align-items: center; justify-content: center; color: #007aff; font-weight: bold; cursor: pointer; }

        /* ç»“æœå±•ç¤º */
        #result-view { display: none; padding: 20px; }
        .win-box { background: #2a2a2a; border-radius: 12px; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--whoop-red); }
        .lose-box { background: #1a1a1a; border-radius: 12px; padding: 12px; margin-bottom: 8px; color: #555; font-size: 14px; border: 1px solid #333; }
        .summary { background: #000; padding: 20px; border-radius: 15px; margin-top: 20px; border: 1px solid #222; }
    </style>
</head>
<body>

<div class="app">
    <div id="setup-view">
        <div class="header">
            <h1>Whoop ç‰¹å…¸æŠ½é€‰</h1>
            <p style="color: #666; font-size: 13px;">THE BOYZ JAPAN EVENT</p>
        </div>

        <div class="section">
            <label>æŒ‡å®šä¸€åæˆå‘˜</label>
            <div class="member-grid" id="memberGrid"></div>
        </div>

        <div class="section">
            <label>è´­ä¹°å¼ æ•° (Â¥3,300/å¼ )</label>
            <input type="number" id="qty" value="10" min="1">
            <button class="pay-trigger" onclick="openPay()">ç¡®è®¤æ”¯ä»˜</button>
        </div>
    </div>

    <div id="result-view">
        <h2 style="text-align:center">æŠ½é€‰ç»“æœåé¦ˆ</h2>
        <div id="drawContainer"></div>
        <div class="summary" id="totalStats"></div>
        <button class="pay-trigger" onclick="location.reload()">é‡æ–°å¼€å§‹</button>
        <button class="m-btn" style="width:100%; margin-top:10px;" onclick="goBack()">ç»§ç»­è´­ä¹°</button>
    </div>
</div>

<div id="apple-pay" onclick="closePay()">
    <div class="pay-sheet" onclick="event.stopPropagation()">
        <div style="text-align:center; font-weight:bold; font-size:18px;">ï£¿ Pay</div>
        <div class="pay-row"><span>å•†æˆ·</span><span>Whoop JP (Global)</span></div>
        <div class="pay-row"><span>è´­ä¹°</span><span id="payDesc"></span></div>
        <div class="pay-row" style="border:none"><span>æ€»è®¡</span><span style="font-size:24px; font-weight:bold;" id="payAmt"></span></div>
        <div class="face-id" onclick="runLottery()">ç¡®è®¤</div>
        <div style="text-align:center; font-size:12px; color:#888;">ç‚¹å‡»â€œç¡®è®¤â€æ¨¡æ‹Ÿé¢å®¹è¯†åˆ«æ”¯ä»˜</div>
    </div>
</div>

<script>
    const members = ["JACOB", "YOUNGHOON", "HYUNJAE", "JUYEON", "KEVIN", "NEW", "Q", "SUNWOO", "ERIC"];
    const prizePool = [
        { name: "åŒäººåˆå½±", prob: 0.015 }, 
        { name: "ç­¾åä¼š", prob: 0.04 }, 
        { name: "æ‰‹æ¸¡ä¼š", prob: 0.08 }, 
        { name: "æ‹æ‰‹ä¼š", prob: 0.15 }
    ];

    let selectedMember = "";
    let totalMoney = 0;
    let totalWins = 0;

    // åˆå§‹åŒ–æˆå‘˜æŒ‰é’®
    const grid = document.getElementById('memberGrid');
    members.forEach(m => {
        const b = document.createElement('button');
        b.className = 'm-btn';
        b.innerText = m;
        b.onclick = () => {
            document.querySelectorAll('.m-btn').forEach(btn => btn.classList.remove('active'));
            b.classList.add('active');
            selectedMember = m;
        };
        grid.appendChild(b);
    });

    function openPay() {
        if (!selectedMember) return alert("è¯·å…ˆé€‰æ‹©æˆå‘˜ï¼");
        const qty = document.getElementById('qty').value;
        document.getElementById('payDesc').innerText = `${selectedMember} æŠ½é€‰åˆ¸ x ${qty}`;
        document.getElementById('payAmt').innerText = `Â¥${(qty * 3300).toLocaleString()}`;
        document.getElementById('apple-pay').style.display = 'flex';
    }

    function closePay() { document.getElementById('apple-pay').style.display = 'none'; }
    function goBack() { document.getElementById('setup-view').style.display = 'block'; document.getElementById('result-view').style.display = 'none'; }

    function runLottery() {
        closePay();
        const qty = parseInt(document.getElementById('qty').value);
        totalMoney += qty * 3300;
        
        document.getElementById('setup-view').style.display = 'none';
        document.getElementById('result-view').style.display = 'block';
        
        const container = document.getElementById('drawContainer');
        container.innerHTML = "";
        let wins = 0;

        for (let i = 1; i <= qty; i++) {
            let rand = Math.random();
            let wonPrize = null;
            let acc = 0;
            
            for (let p of prizePool) {
                if (rand < p.prob) {
                    wonPrize = p;
                    break;
                }
            }

            if (wonPrize) {
                wins++; totalWins++;
                container.innerHTML += `<div class="win-box">
                    <span>${selectedMember}</span>
                    <span style="font-weight:bold">${wonPrize.name} ğŸ‰</span>
                </div>`;
            } else if (qty <= 20) {
                container.innerHTML += `<div class="lose-box">ç¬¬ ${i} å¼ ï¼šæœªä¸­é€‰</div>`;
            }
        }

        if (qty > 20) {
            container.innerHTML += `<div style="text-align:center; padding:10px; color:#666;">...å…¶ä½™æœªä¸­é€‰ç»“æœå·²ç•¥è¿‡...</div>`;
        }

        document.getElementById('totalStats').innerHTML = `
            <div style="color:var(--whoop-red); margin-bottom:10px;">æœ¬æ¬¡ä¸­å¥–ï¼š${wins} ä¸ªé¡¹ç›®</div>
            <div style="font-size:13px; color:#888;">
                ç´¯è®¡è´­ä¹°é‡‘é¢ï¼š<span style="color:white">Â¥${totalMoney.toLocaleString()}</span><br>
                ç´¯è®¡è·å¾—æ•°é‡ï¼š<span style="color:white">${totalWins}</span>
            </div>
        `;
    }
</script>
</body>
</html>
